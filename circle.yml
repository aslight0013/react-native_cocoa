general:
  branches:
    ignore:
      - gh-pages # list of branches to ignore
machine:
  xcode:
    version: 7.2
  node:
    version: 5.6.0

dependencies:
  pre:
    - brew update || brew update
    - brew outdated xctool || brew upgrade xctool
  cache_directories:
    - node_modules
    - .nvm
  override:
    - brew reinstall nvm
    - mkdir -p .nvm
    - export NVM_DIR="$PWD/.nvm"
    - source $(brew --prefix nvm)/nvm.sh
    - nvm install 5
    - rm -Rf "${TMPDIR}/jest_preprocess_cache"
    - npm config set spin=false
    - npm config set progress=false
    - npm install
    - node --version
    - npm --version

test:

  override:
    - ./scripts/objc-test.sh
    - npm run flow && npm test
    - ./scripts/e2e-test.sh  --packager
